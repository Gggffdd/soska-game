<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>üî• Soska Chase Ultimate</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #0f0f1a;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .hidden {
            display: none !important;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #0f0f1a;
        }
        
        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –º–µ–Ω—é */
        .menu-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            animation: bgPulse 8s ease-in-out infinite;
        }
        
        @keyframes bgPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        .menu-content {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 2.5em;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 1em;
            color: white;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 10;
            max-width: 90%;
        }
        
        .menu-content h1 {
            font-size: 2.8em;
            margin-bottom: 0.3em;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: titleGlow 3s ease-in-out infinite;
        }
        
        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 107, 107, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(254, 202, 87, 0.8)); }
        }
        
        .menu-btn {
            padding: 1.2em 2em;
            font-size: 1.1em;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            margin: 0.7em;
            width: 250px;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        
        .menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .menu-btn:hover::before {
            left: 100%;
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
        }
        
        .menu-btn:active {
            transform: translateY(-1px);
        }
        
        .special-btn {
            background: linear-gradient(135deg, #feca57, #ff9f43);
            box-shadow: 0 8px 20px rgba(254, 202, 87, 0.3);
        }
        
        .premium-btn {
            background: linear-gradient(135deg, #48dbfb, #0abde3);
            box-shadow: 0 8px 20px rgba(72, 219, 251, 0.3);
        }
        
        #gameHUD {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .hud-top {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            color: white;
            font-size: 1.1em;
        }
        
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
        }
        
        .stat-value {
            color: #feca57;
            font-weight: bold;
        }
        
        .health-indicators {
            display: flex;
            gap: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .health-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .health-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: 0.5s;
        }
        
        .health-indicator.active {
            background: #feca57;
            border-color: #ffa726;
            box-shadow: 0 0 15px #feca57;
        }
        
        .health-indicator.active::before {
            left: 100%;
        }
        
        .powerup-indicators {
            display: flex;
            gap: 6px;
            margin-top: 10px;
            justify-content: center;
        }
        
        .powerup-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .powerup-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .powerup-indicator.speed { background: #48dbfb; border-color: #0abde3; }
        .powerup-indicator.slow { background: #ff9ff3; border-color: #f368e0; }
        .powerup-indicator.magnet { background: #feca57; border-color: #ff9f43; }
        .powerup-indicator.shield { background: #1dd1a1; border-color: #10ac84; }
        
        /* –ü–ª–∞–≤–∞—é—â–∏–π –¥–∂–æ–π—Å—Ç–∏–∫ */
        #floatingJoystick {
            position: absolute;
            width: 180px;
            height: 180px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .joystick-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .joystick-handle {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .action-buttons {
            position: absolute;
            right: 25px;
            bottom: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            pointer-events: auto;
        }
        
        .action-btn {
            width: 85px;
            height: 85px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.15);
            font-size: 2em;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            transition: all 0.2s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .barrier-active {
            background: rgba(254, 202, 87, 0.3) !important;
            border: 3px solid #feca57 !important;
            box-shadow: 0 0 30px #feca57;
            animation: barrierPulse 1s ease-in-out infinite;
        }
        
        @keyframes barrierPulse {
            0%, 100% { box-shadow: 0 0 20px #feca57; }
            50% { box-shadow: 0 0 40px #feca57; }
        }
        
        .controls-hint {
            position: absolute;
            bottom: 140px;
            left: 0;
            right: 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95em;
            pointer-events: none;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            backdrop-filter: blur(10px);
        }
        
        .combo-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            color: #feca57;
            font-weight: bold;
            text-shadow: 0 0 30px rgba(254, 202, 87, 0.8);
            pointer-events: none;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
        }
        
        .mission-popup {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.1em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            text-align: center;
            border: 2px solid #feca57;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .upgrade-notification {
            position: absolute;
            bottom: 220px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
        }
        
        .ability-cooldown {
            position: absolute;
            bottom: 120px;
            right: 25px;
            color: #ff6b6b;
            font-size: 0.85em;
            pointer-events: none;
            text-align: center;
            width: 85px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .xp-bar {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #48dbfb, #0abde3);
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .xp-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: xpShine 2s infinite;
        }
        
        @keyframes xpShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px #feca57; }
            50% { box-shadow: 0 0 40px #feca57; }
        }
        
        .pulse { animation: pulse 2s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .glow { animation: glow 2s ease-in-out infinite; }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
        <div class="menu-bg"></div>
        
        <div id="loadingScreen" class="screen">
            <div class="menu-content">
                <h1>üî• SOSKA CHASE ULTIMATE</h1>
                <div id="loadingStatus" style="margin: 20px 0; font-size: 1.1em;">–ó–∞–≥—Ä—É–∑–∫–∞ —ç–ø–∏—á–µ—Å–∫–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π...</div>
                <div style="width: 300px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px; margin: 30px auto; overflow: hidden;">
                    <div id="loadingProgress" style="width: 0%; height: 100%; background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb); border-radius: 6px; transition: width 0.3s;"></div>
                </div>
                <button class="menu-btn pulse" onclick="skipLoading()">üöÄ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
            </div>
        </div>

        <div id="mainMenu" class="screen">
            <div class="menu-content">
                <h1>üî• SOSKA CHASE ULTIMATE</h1>
                <p style="margin-bottom: 1.5em; color: rgba(255,255,255,0.9); line-height: 1.5; font-size: 1.1em;">
                    üéÆ –ë–µ–≥–∏ –æ—Ç –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–π —Å–æ—Å–∫–∏ 69!<br>
                    ‚ö° –°–æ–±–∏—Ä–∞–π —É–ª—É—á—à–µ–Ω–∏—è, –≤—ã–ø–æ–ª–Ω—è–π –º–∏—Å—Å–∏–∏<br>
                    üèÜ –°—Ç–∞–Ω–æ–≤–∏—Å—å —Å–∞–º—ã–º –±—ã—Å—Ç—Ä—ã–º –±–µ–≥—É–Ω–æ–º!
                </p>
                <button class="menu-btn pulse glow" onclick="startGame()">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button class="menu-btn special-btn" onclick="showUpgrades()">‚≠ê –£–ª—É—á—à–µ–Ω–∏—è</button>
                <button class="menu-btn premium-btn" onclick="showMissions()">üéØ –ú–∏—Å—Å–∏–∏</button>
                <button class="menu-btn" onclick="showInstructions()">‚ùì –û–±—É—á–µ–Ω–∏–µ</button>
                
                <div style="margin-top: 2em; padding: 1.5em; background: rgba(0,0,0,0.3); border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                    <div class="stat-item">
                        <span>üèÜ –†–µ–∫–æ—Ä–¥: </span>
                        <span id="menuBestTime" class="stat-value">00:00</span>
                    </div>
                    <div class="stat-item">
                        <span>‚≠ê –£—Ä–æ–≤–µ–Ω—å: </span>
                        <span id="menuLevel" class="stat-value">1</span>
                    </div>
                    <div class="stat-item">
                        <span>üéØ –û—á–∫–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π: </span>
                        <span id="menuPoints" class="stat-value">0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="upgradesScreen" class="screen hidden">
            <div class="menu-content">
                <h1>‚≠ê –°–ò–°–¢–ï–ú–ê –£–õ–£–ß–®–ï–ù–ò–ô</h1>
                <div style="text-align: left; margin: 1.5em 0; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    <div class="upgrade-item" style="background: rgba(255,255,255,0.1); padding: 1.5em; margin: 1em 0; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #48dbfb; margin-bottom: 0.5em;">‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –±–µ–≥–∞</h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1em;">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ 25% –∑–∞ —É—Ä–æ–≤–µ–Ω—å</p>
                        <div class="stat-item">
                            <span>–£—Ä–æ–≤–µ–Ω—å: </span>
                            <span id="speedLevel" class="stat-value">1</span>
                        </div>
                        <button class="menu-btn" onclick="buyUpgrade('speed')" style="width: auto; padding: 0.8em 1.5em; font-size: 0.95em; margin: 0.5em 0;">üõí –ö—É–ø–∏—Ç—å (15 –æ—á–∫–æ–≤)</button>
                    </div>
                    
                    <div class="upgrade-item" style="background: rgba(255,255,255,0.1); padding: 1.5em; margin: 1em 0; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #feca57; margin-bottom: 0.5em;">üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–∞—Ä—å–µ—Ä</h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1em;">+1 –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä—å–µ—Ä–æ–≤ –∑–∞ —É—Ä–æ–≤–µ–Ω—å</p>
                        <div class="stat-item">
                            <span>–£—Ä–æ–≤–µ–Ω—å: </span>
                            <span id="barrierLevel" class="stat-value">1</span>
                        </div>
                        <button class="menu-btn" onclick="buyUpgrade('barrier')" style="width: auto; padding: 0.8em 1.5em; font-size: 0.95em; margin: 0.5em 0;">üõí –ö—É–ø–∏—Ç—å (20 –æ—á–∫–æ–≤)</button>
                    </div>
                    
                    <div class="upgrade-item" style="background: rgba(255,255,255,0.1); padding: 1.5em; margin: 1em 0; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #ff9ff3; margin-bottom: 0.5em;">üß≤ –ú–∞–≥–Ω–∏—Ç –¥–ª—è –±–∞—Ä—å–µ—Ä–æ–≤</h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1em;">–ë–∞—Ä—å–µ—Ä—ã –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∫ –≤–∞–º —Å –±–æ–ª—å—à–µ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è</p>
                        <div class="stat-item">
                            <span>–£—Ä–æ–≤–µ–Ω—å: </span>
                            <span id="magnetLevel" class="stat-value">0</span>
                        </div>
                        <button class="menu-btn" onclick="buyUpgrade('magnet')" style="width: auto; padding: 0.8em 1.5em; font-size: 0.95em; margin: 0.5em 0;">üõí –ö—É–ø–∏—Ç—å (30 –æ—á–∫–æ–≤)</button>
                    </div>
                </div>
                <div class="stat-item" style="justify-content: center; margin-top: 1.5em; font-size: 1.3em; background: rgba(254, 202, 87, 0.2); padding: 1em; border-radius: 10px;">
                    <span>üéØ –î–æ—Å—Ç—É–ø–Ω–æ –æ—á–∫–æ–≤: </span>
                    <span id="upgradePoints" class="stat-value">0</span>
                </div>
                <button class="menu-btn" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
            </div>
        </div>

        <div id="missionsScreen" class="screen hidden">
            <div class="menu-content">
                <h1>üéØ –ê–ö–¢–ò–í–ù–´–ï –ú–ò–°–°–ò–ò</h1>
                <div style="text-align: left; margin: 1.5em 0; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    <div id="missionsList">
                        <!-- –ú–∏—Å—Å–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
                <button class="menu-btn" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
            </div>
        </div>

        <div id="instructionsScreen" class="screen hidden">
            <div class="menu-content">
                <h1>üéÆ –û–ë–£–ß–ï–ù–ò–ï</h1>
                <div style="text-align: left; margin: 1.5em 0; line-height: 1.7; font-size: 1.05em;">
                    <div style="background: rgba(255,255,255,0.1); padding: 1.5em; border-radius: 15px; margin-bottom: 1em;">
                        <p>üéØ <strong>–¶–µ–ª—å –∏–≥—Ä—ã:</strong> –£–±–µ–≥–∞–π—Ç–µ –æ—Ç —Å–æ—Å–∫–∏ 69 –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ!</p>
                        <p>üëÜ <strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> –ö–∞—Å–∞–π—Ç–µ—Å—å –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ - –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–∂–æ–π—Å—Ç–∏–∫</p>
                        <p>üõ°Ô∏è <strong>–ë–∞—Ä—å–µ—Ä—ã:</strong> –°–æ–±–∏—Ä–∞–π—Ç–µ —â–∏—Ç—ã –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∑–∞—â–∏—Ç—É –∫–Ω–æ–ø–∫–æ–π —Å–ø—Ä–∞–≤–∞</p>
                        <p>‚ö° <strong>–£–ª—É—á—à–µ–Ω–∏—è:</strong> –°–æ–±–∏—Ä–∞–π—Ç–µ –±–æ–Ω—É—Å—ã –¥–ª—è –æ—Å–æ–±—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π</p>
                    </div>
                    
                    <div style="background: rgba(254, 202, 87, 0.2); padding: 1.5em; border-radius: 15px; margin-bottom: 1em;">
                        <h3 style="color: #feca57; margin-bottom: 0.8em;">üåü –°–ï–ö–†–ï–¢–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:</h3>
                        <p>‚Ä¢ üî• –ö–æ–º–±–æ –∑–∞ —Å–±–æ—Ä –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∞—Ä—å–µ—Ä–æ–≤ –ø–æ–¥—Ä—è–¥</p>
                        <p>‚Ä¢ ‚≠ê –†–µ–¥–∫–∏–µ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è</p>
                        <p>‚Ä¢ üèÜ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –Ω–∞–≥—Ä–∞–¥—ã</p>
                        <p>‚Ä¢ üìà –ü—Ä–æ–∫–∞—á–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫</p>
                    </div>
                    
                    <div style="background: rgba(72, 219, 251, 0.2); padding: 1.5em; border-radius: 15px;">
                        <h3 style="color: #48dbfb; margin-bottom: 0.8em;">üí° –°–û–í–ï–¢–´ –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–ê:</h3>
                        <p>‚Ä¢ –î–≤–∏–≥–∞–π—Ç–µ—Å—å –ø–æ –∫—Ä—É–≥—É - —Å–ª–æ–∂–Ω–µ–µ –¥–æ–≥–Ω–∞—Ç—å</p>
                        <p>‚Ä¢ –°–æ–±–∏—Ä–∞–π—Ç–µ –±–∞—Ä—å–µ—Ä—ã –∑–∞—Ä–∞–Ω–µ–µ</p>
                        <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö</p>
                        <p>‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–æ–π –∑–∞—â–∏—Ç—ã</p>
                    </div>
                </div>
                <button class="menu-btn pulse" onclick="showMainMenu()">üéÆ –ü–æ–Ω—è—Ç–Ω–æ, –Ω–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å!</button>
            </div>
        </div>

        <div id="gameScreen" class="screen hidden">
            <canvas id="gameCanvas"></canvas>
            
            <div id="gameHUD">
                <!-- –ü–æ–ª–æ—Å–∞ –æ–ø—ã—Ç–∞ -->
                <div class="xp-bar">
                    <div class="xp-progress" id="xpProgress" style="width: 0%"></div>
                </div>
                
                <div class="hud-top">
                    <div class="stats-container">
                        <div class="stat-item">
                            <span>‚è±Ô∏è –í—Ä–µ–º—è: </span>
                            <span id="timer" class="stat-value">00:00</span>
                        </div>
                        <div class="stat-item">
                            <span>üéØ –î–∏—Å—Ç–∞–Ω—Ü–∏—è: </span>
                            <span id="distance" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span>‚≠ê –£—Ä–æ–≤–µ–Ω—å: </span>
                            <span id="level" class="stat-value">1</span>
                        </div>
                        <div class="stat-item">
                            <span>üî• –ö–æ–º–±–æ: </span>
                            <span id="combo" class="stat-value">x1</span>
                        </div>
                    </div>
                    
                    <div>
                        <div class="health-indicators" id="healthIndicators">
                            <div class="health-indicator"></div>
                            <div class="health-indicator"></div>
                            <div class="health-indicator"></div>
                        </div>
                        <div class="powerup-indicators" id="powerupIndicators">
                            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —É–ª—É—á—à–µ–Ω–∏–π -->
                        </div>
                    </div>
                </div>
                
                <!-- –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="combo-display" id="comboDisplay"></div>
                <div class="mission-popup" id="missionPopup"></div>
                <div class="upgrade-notification" id="upgradeNotification"></div>
                
                <!-- –ü–ª–∞–≤–∞—é—â–∏–π –¥–∂–æ–π—Å—Ç–∏–∫ -->
                <div id="floatingJoystick">
                    <div class="joystick-base"></div>
                    <div class="joystick-handle"></div>
                </div>
                
                <div class="controls-hint">
                    üëÜ –ö–∞—Å–∞–π—Ç–µ—Å—å –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn" id="useBarrier">üõ°Ô∏è</button>
                    <div class="ability-cooldown" id="abilityCooldown"></div>
                </div>
            </div>
        </div>

        <div id="gameOverScreen" class="screen hidden">
            <div class="menu-content">
                <h1>üíÄ GAME OVER</h1>
                <p style="font-size: 1.3em; margin-bottom: 1.5em; color: #ff6b6b;">–°–æ—Å–∫–∞ 69 –¥–æ–≥–Ω–∞–ª–∞ –≤–∞—Å!</p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 2em; border-radius: 20px; margin: 1.5em 0; border: 1px solid rgba(255,255,255,0.1);">
                    <div class="stat-item" style="font-size: 1.2em; margin: 1em 0;">
                        <span>‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–∂–∏–≤–∞–Ω–∏—è: </span>
                        <span id="finalTime" class="stat-value">00:00</span>
                    </div>
                    <div class="stat-item" style="margin: 1em 0;">
                        <span>üõ°Ô∏è –°–æ–±—Ä–∞–Ω–æ –±–∞—Ä—å–µ—Ä–æ–≤: </span>
                        <span id="finalBarriers" class="stat-value">0</span>
                    </div>
                    <div class="stat-item" style="margin: 1em 0;">
                        <span>üéØ –ü—Ä–æ–π–¥–µ–Ω–æ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏: </span>
                        <span id="finalDistance" class="stat-value">0</span>
                    </div>
                    <div class="stat-item" style="margin: 1em 0;">
                        <span>‚≠ê –ü–æ–ª—É—á–µ–Ω–æ –æ–ø—ã—Ç–∞: </span>
                        <span id="finalXP" class="stat-value">0</span>
                    </div>
                    <div class="stat-item" style="margin: 1em 0; color: #feca57; font-size: 1.1em;">
                        <span>üèÜ –ù–æ–≤—ã–µ –æ—á–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π: </span>
                        <span id="newUpgradePoints" class="stat-value">0</span>
                    </div>
                </div>

                <div id="achievementsEarned" style="margin: 1.5em 0;">
                    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
                </div>
                
                <button class="menu-btn pulse glow" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                <button class="menu-btn" onclick="showMainMenu()">üìã –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        const GameConstants = {
            PLAYER_SIZE: 18,
            ENEMY_SIZE: 35,
            BARRIER_SIZE: 12,
            POWERUP_SIZE: 16,
            PLAYER_SPEED: 4.5,
            BARRIER_SPAWN_RATE: 400,
            POWERUP_SPAWN_RATE: 800,
            MAX_BARRIERS: 6,
            MAX_POWERUPS: 4,
            JOYSTICK_RADIUS: 80,
            BARRIER_COOLDOWN: 60,
            COMBO_TIMEOUT: 180,
            LEVEL_UP_XP: 100,
            MAGNET_RANGE: 200
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameTime = 0;
        let gameInterval = null;
        let player = {
            x: 0, y: 0, barriers: 0, hasActiveBarrier: false, barrierCooldown: 0,
            speed: GameConstants.PLAYER_SPEED, maxBarriers: 3, level: 1, xp: 0,
            powerups: { speed: 0, slow: 0, magnet: 0, shield: 0 }, combo: 1, comboTimeout: 0,
            totalDistance: 0, upgrades: { speed: 1, barrier: 1, magnet: 0 },
            upgradePoints: 0, isInvulnerable: false, color: '#48dbfb', size: GameConstants.PLAYER_SIZE,
            barriersCollected: 0, barriersUsed: 0
        };
        
        let enemy = { 
            x: 0, y: 0, speed: 2.2, baseSpeed: 2.2,
            size: GameConstants.ENEMY_SIZE, color: '#ff6b6b'
        };
        
        let barriers = [];
        let powerups = [];
        let particles = [];
        let isJoystickActive = false;
        let barrierSpawnTimer = 0;
        let powerupSpawnTimer = 0;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ –∏–≥—Ä—É
        let currentGameStats = {
            barriersCollected: 0,
            barriersUsed: 0,
            distance: 0,
            time: 0,
            xp: 0
        };
        
        // –°–∏—Å—Ç–µ–º–∞ –º–∏—Å—Å–∏–π
        let missions = [
            { 
                id: 'survive_30', 
                name: '–í—ã–∂–∏—Ç—å 30 —Å–µ–∫—É–Ω–¥', 
                description: '–ü—Ä–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –ø—Ä–æ—Ç–∏–≤ —Å–æ—Å–∫–∏ 69 —Ü–µ–ª—ã—Ö 30 —Å–µ–∫—É–Ω–¥!',
                target: 30, 
                completed: false, 
                reward: 10,
                type: 'time',
                currentProgress: 0
            },
            { 
                id: 'collect_5', 
                name: '–°–æ–±—Ä–∞—Ç—å 5 –±–∞—Ä—å–µ—Ä–æ–≤', 
                description: '–°–æ–±–µ—Ä–∏—Ç–µ 5 –∑–∞—â–∏—Ç–Ω—ã—Ö –±–∞—Ä—å–µ—Ä–æ–≤ –∑–∞ –æ–¥–Ω—É –∏–≥—Ä—É',
                target: 5, 
                completed: false, 
                reward: 15,
                type: 'collect',
                currentProgress: 0
            },
            { 
                id: 'combo_3', 
                name: '–ö–æ–º–±–æ x3', 
                description: '–°–æ–±–µ—Ä–∏—Ç–µ 3 –±–∞—Ä—å–µ—Ä–∞ –ø–æ–¥—Ä—è–¥ –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞',
                target: 3, 
                completed: false, 
                reward: 20,
                type: 'combo',
                currentProgress: 0
            },
            { 
                id: 'distance_500', 
                name: '–ü—Ä–æ–±–µ–∂–∞—Ç—å 500 –µ–¥–∏–Ω–∏—Ü', 
                description: '–ü—Ä–µ–æ–¥–æ–ª–µ–π—Ç–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –≤ 500 –µ–¥–∏–Ω–∏—Ü',
                target: 500, 
                completed: false, 
                reward: 25,
                type: 'distance',
                currentProgress: 0
            },
            { 
                id: 'use_barriers_3', 
                name: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 3 –±–∞—Ä—å–µ—Ä–∞', 
                description: '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∑–∞—â–∏—Ç—É 3 —Ä–∞–∑–∞ –∑–∞ –∏–≥—Ä—É',
                target: 3, 
                completed: false, 
                reward: 18,
                type: 'ability',
                currentProgress: 0
            }
        ];

        // ==================== –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø ====================
        function saveGame() {
            const saveData = {
                player: {
                    level: player.level,
                    xp: player.xp,
                    upgrades: player.upgrades,
                    upgradePoints: player.upgradePoints
                },
                missions: missions,
                bestTime: Math.max(currentGameStats.time, getBestTime() || 0),
                totalUpgradePoints: player.upgradePoints + (getTotalUpgradePoints() || 0)
            };
            localStorage.setItem('soskaChaseUltimateSave', JSON.stringify(saveData));
        }

        function loadGame() {
            const saveData = JSON.parse(localStorage.getItem('soskaChaseUltimateSave'));
            if (saveData) {
                player.level = saveData.player?.level || 1;
                player.xp = saveData.player?.xp || 0;
                player.upgrades = saveData.player?.upgrades || { speed: 1, barrier: 1, magnet: 0 };
                player.upgradePoints = saveData.player?.upgradePoints || 0;
                missions = saveData.missions || missions;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è
                applyUpgrades();
                updateMenuStats();
            }
        }

        function getBestTime() {
            const saveData = JSON.parse(localStorage.getItem('soskaChaseUltimateSave'));
            return saveData?.bestTime || 0;
        }

        function getTotalUpgradePoints() {
            const saveData = JSON.parse(localStorage.getItem('soskaChaseUltimateSave'));
            return saveData?.totalUpgradePoints || 0;
        }

        function applyUpgrades() {
            player.speed = GameConstants.PLAYER_SPEED * (1 + (player.upgrades.speed - 1) * 0.25);
            player.maxBarriers = 2 + player.upgrades.barrier;
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ù–ê–í–ò–ì–ê–¶–ò–ò ====================
        function skipLoading() {
            showMainMenu();
        }
        
        function showMainMenu() {
            hideAllScreens();
            document.getElementById('mainMenu').classList.remove('hidden');
            updateMenuStats();
        }
        
        function showUpgrades() {
            hideAllScreens();
            document.getElementById('upgradesScreen').classList.remove('hidden');
            updateUpgradesDisplay();
        }
        
        function showMissions() {
            hideAllScreens();
            document.getElementById('missionsScreen').classList.remove('hidden');
            updateMissionsDisplay();
        }
        
        function showInstructions() {
            hideAllScreens();
            document.getElementById('instructionsScreen').classList.remove('hidden');
        }
        
        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ====================
        function startGame() {
            hideAllScreens();
            document.getElementById('gameScreen').classList.remove('hidden');
            initializeGame();
            startGameLoop();
        }

        function initializeGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            gameTime = 0;
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            player.barriers = 0;
            player.hasActiveBarrier = false;
            player.barrierCooldown = 0;
            player.combo = 1;
            player.comboTimeout = 0;
            player.totalDistance = 0;
            player.xp = 0;
            player.isInvulnerable = false;
            player.barriersCollected = 0;
            player.barriersUsed = 0;

            // –°–±—Ä–æ—Å —É–ª—É—á—à–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –Ω–∞ –≤—Ä–µ–º—è –∏–≥—Ä—ã)
            player.powerups = { speed: 0, slow: 0, magnet: 0, shield: 0 };

            // –í—Ä–∞–≥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –æ—Ç –∏–≥—Ä–æ–∫–∞
            let safeDistance = false;
            while (!safeDistance) {
                enemy.x = Math.random() * canvas.width;
                enemy.y = Math.random() * canvas.height;
                const dist = Math.sqrt((player.x - enemy.x) ** 2 + (player.y - enemy.y) ** 2);
                if (dist > 300) safeDistance = true;
            }
            enemy.speed = enemy.baseSpeed;

            barriers = [];
            powerups = [];
            particles = [];
            barrierSpawnTimer = 0;
            powerupSpawnTimer = 0;

            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã
            currentGameStats = {
                barriersCollected: 0,
                barriersUsed: 0,
                distance: 0,
                time: 0,
                xp: 0
            };

            // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–∏—Å—Å–∏–π –¥–ª—è —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã
            missions.forEach(mission => {
                mission.currentProgress = 0;
            });

            initControls();
            updateHUD();
            updateXPBar();
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø ====================
        function initControls() {
            const canvas = document.getElementById('gameCanvas');
            const barrierBtn = document.getElementById('useBarrier');
            let currentTouchId = null;
            let moveX = 0, moveY = 0;

            // Touch —Å–æ–±—ã—Ç–∏—è
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);

            // Mouse —Å–æ–±—ã—Ç–∏—è
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);

            // –ö–Ω–æ–ø–∫–∞ –±–∞—Ä—å–µ—Ä–∞
            barrierBtn.addEventListener('click', useBarrier);
            barrierBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                useBarrier();
            });

            function handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                if (x < canvas.width / 2) {
                    activateJoystick(x, y);
                    currentTouchId = touch.identifier;
                }
            }

            function handleTouchMove(e) {
                if (!isJoystickActive) return;
                e.preventDefault();
                const touch = Array.from(e.touches).find(t => t.identifier === currentTouchId);
                if (touch) {
                    const rect = canvas.getBoundingClientRect();
                    updateJoystick(touch.clientX - rect.left, touch.clientY - rect.top);
                }
            }

            function handleTouchEnd(e) {
                if (isJoystickActive) deactivateJoystick();
                currentTouchId = null;
            }

            function handleMouseDown(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                if (x < canvas.width / 2) activateJoystick(x, y);
            }

            function handleMouseMove(e) {
                if (!isJoystickActive) return;
                const rect = canvas.getBoundingClientRect();
                updateJoystick(e.clientX - rect.left, e.clientY - rect.top);
            }

            function handleMouseUp() {
                if (isJoystickActive) deactivateJoystick();
            }

            function activateJoystick(x, y) {
                isJoystickActive = true;
                const joystick = document.getElementById('floatingJoystick');
                joystick.style.left = (x - 90) + 'px';
                joystick.style.top = (y - 90) + 'px';
                joystick.style.display = 'block';
                moveX = 0; moveY = 0;
            }

            function updateJoystick(x, y) {
                const joystick = document.getElementById('floatingJoystick');
                const baseX = parseInt(joystick.style.left) + 90;
                const baseY = parseInt(joystick.style.top) + 90;
                
                const deltaX = x - baseX;
                const deltaY = y - baseY;
                
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = GameConstants.JOYSTICK_RADIUS;
                
                if (distance > maxDistance) {
                    const scale = maxDistance / distance;
                    moveX = (deltaX * scale) / maxDistance;
                    moveY = (deltaY * scale) / maxDistance;
                } else {
                    moveX = deltaX / maxDistance;
                    moveY = deltaY / maxDistance;
                }
                
                const handle = document.querySelector('.joystick-handle');
                const handleX = Math.min(maxDistance, Math.max(-maxDistance, deltaX));
                const handleY = Math.min(maxDistance, Math.max(-maxDistance, deltaY));
                handle.style.transform = `translate(calc(-50% + ${handleX}px), calc(-50% + ${handleY}px))`;
            }

            function deactivateJoystick() {
                isJoystickActive = false;
                moveX = 0; moveY = 0;
                document.getElementById('floatingJoystick').style.display = 'none';
                document.querySelector('.joystick-handle').style.transform = 'translate(-50%, -50%)';
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
            window.gameMoveState = { isMoving: false, moveX: 0, moveY: 0 };
            setInterval(() => {
                window.gameMoveState = { isMoving: isJoystickActive, moveX, moveY };
            }, 16);
        }

        function useBarrier() {
            if (player.barriers > 0 && !player.hasActiveBarrier && player.barrierCooldown === 0) {
                player.barriers--;
                player.hasActiveBarrier = true;
                player.barriersUsed++;
                currentGameStats.barriersUsed++;
                updateHUD();
                
                const barrierBtn = document.getElementById('useBarrier');
                barrierBtn.classList.add('barrier-active');
                
                // –≠—Ñ—Ñ–µ–∫—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
                createParticles(player.x, player.y, 25, '#feca57');
                showComboEffect('üõ°Ô∏è –ó–ê–©–ò–¢–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê!');
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ ====================
        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1,
                    color: color || '#ffffff',
                    size: Math.random() * 6 + 2,
                    decay: 0.02 + Math.random() * 0.02
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= p.decay;
                p.vx *= 0.92;
                p.vy *= 0.92;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        function drawParticles(ctx) {
            particles.forEach(p => {
                ctx.save();
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –£–õ–£–ß–®–ï–ù–ò–ô ====================
        function spawnPowerup() {
            const canvas = document.getElementById('gameCanvas');
            const types = ['speed', 'slow', 'magnet', 'shield'];
            const weights = [0.35, 0.25, 0.25, 0.15]; // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
            const type = getWeightedRandom(types, weights);
            
            powerups.push({
                x: Math.random() * (canvas.width - 60) + 30,
                y: Math.random() * (canvas.height - 60) + 30,
                type: type,
                size: GameConstants.POWERUP_SIZE,
                color: getPowerupColor(type),
                rotation: 0
            });
        }

        function getWeightedRandom(items, weights) {
            const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < items.length; i++) {
                random -= weights[i];
                if (random <= 0) return items[i];
            }
            return items[items.length - 1];
        }

        function getPowerupColor(type) {
            const colors = {
                speed: '#48dbfb',
                slow: '#ff9ff3', 
                magnet: '#feca57',
                shield: '#1dd1a1'
            };
            return colors[type] || '#ffffff';
        }

        function collectPowerups() {
            for (let i = powerups.length - 1; i >= 0; i--) {
                const p = powerups[i];
                const dist = Math.sqrt((player.x - p.x) ** 2 + (player.y - p.y) ** 2);
                
                if (dist < player.size + p.size) {
                    player.powerups[p.type] += 300; // 5 —Å–µ–∫—É–Ω–¥
                    
                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π
                    switch(p.type) {
                        case 'speed':
                            showUpgradeNotification('‚ö° –°–ö–û–†–û–°–¢–¨ –ü–û–í–´–®–ï–ù–ê!');
                            createParticles(p.x, p.y, 20, '#48dbfb');
                            break;
                        case 'slow':
                            showUpgradeNotification('üåÄ –í–†–ê–ì –ó–ê–ú–ï–î–õ–ï–ù!');
                            createParticles(p.x, p.y, 20, '#ff9ff3');
                            break;
                        case 'magnet':
                            showUpgradeNotification('üß≤ –ú–ê–ì–ù–ò–¢ –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!');
                            createParticles(p.x, p.y, 20, '#feca57');
                            break;
                        case 'shield':
                            showUpgradeNotification('üíé –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê!');
                            createParticles(p.x, p.y, 25, '#1dd1a1');
                            player.barriers = Math.min(player.barriers + 1, player.maxBarriers);
                            updateHUD();
                            break;
                    }
                    
                    powerups.splice(i, 1);
                }
            }
        }

        function updatePowerups() {
            // –ú–∞–≥–Ω–∏—Ç –¥–ª—è –±–∞—Ä—å–µ—Ä–æ–≤
            if (player.powerups.magnet > 0 || player.upgrades.magnet > 0) {
                const magnetStrength = player.upgrades.magnet > 0 ? 0.4 : 0.2;
                for (let i = barriers.length - 1; i >= 0; i--) {
                    const b = barriers[i];
                    const dx = player.x - b.x;
                    const dy = player.y - b.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < GameConstants.MAGNET_RANGE) {
                        const force = magnetStrength * (1 - dist / GameConstants.MAGNET_RANGE);
                        b.x += (dx / dist) * force;
                        b.y += (dy / dist) * force;
                    }
                }
            }

            // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —É–ª—É—á—à–µ–Ω–∏–π
            for (const type in player.powerups) {
                if (player.powerups[type] > 0) {
                    player.powerups[type]--;
                }
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ú–ò–°–°–ò–ô ====================
        function checkMissions() {
            let completedCount = 0;
            
            missions.forEach(mission => {
                if (mission.completed) {
                    completedCount++;
                    return;
                }
                
                let progress = 0;
                switch (mission.type) {
                    case 'time': 
                        progress = Math.floor(gameTime);
                        break;
                    case 'collect': 
                        progress = currentGameStats.barriersCollected;
                        break;
                    case 'combo': 
                        progress = player.combo;
                        break;
                    case 'distance': 
                        progress = Math.floor(currentGameStats.distance);
                        break;
                    case 'ability': 
                        progress = currentGameStats.barriersUsed;
                        break;
                }
                
                mission.currentProgress = Math.max(mission.currentProgress, progress);
                
                if (mission.currentProgress >= mission.target && !mission.completed) {
                    mission.completed = true;
                    player.upgradePoints += mission.reward;
                    showMissionComplete(mission.name, mission.reward);
                    saveGame();
                    updateMenuStats();
                }
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∏—Å—Å–∏–π
            if (completedCount === missions.length) {
                showMissionComplete('–í–°–ï –ú–ò–°–°–ò–ò –í–´–ü–û–õ–ù–ï–ù–´!', 50);
            }
        }

        function updateMissionsDisplay() {
            const missionsList = document.getElementById('missionsList');
            missionsList.innerHTML = '';
            
            missions.forEach(mission => {
                const missionElement = document.createElement('div');
                missionElement.style.background = mission.completed ? 
                    'rgba(76, 175, 80, 0.2)' : 'rgba(255,255,255,0.1)';
                missionElement.style.padding = '1.2em';
                missionElement.style.margin = '0.8em 0';
                missionElement.style.borderRadius = '12px';
                missionElement.style.border = mission.completed ? 
                    '1px solid #4caf50' : '1px solid rgba(255,255,255,0.1)';
                
                const progress = mission.currentProgress || 0;
                const progressPercent = Math.min((progress / mission.target) * 100, 100);
                
                missionElement.innerHTML = `
                    <h3 style="color: ${mission.completed ? '#4caf50' : '#feca57'}; margin-bottom: 0.5em;">
                        ${mission.completed ? '‚úÖ' : 'üéØ'} ${mission.name}
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 0.8em; font-size: 0.9em;">
                        ${mission.description}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
                        <span style="font-size: 0.9em;">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.floor(progress)}/${mission.target}</span>
                        <span style="color: #feca57; font-weight: bold;">+${mission.reward} –æ—á–∫–æ–≤</span>
                    </div>
                    <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; overflow: hidden;">
                        <div style="width: ${progressPercent}%; height: 100%; background: linear-gradient(90deg, #feca57, #ff9f43); border-radius: 3px; transition: width 0.3s;"></div>
                    </div>
                `;
                
                missionsList.appendChild(missionElement);
            });
        }

        // ==================== –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–§–§–ï–ö–¢–´ ====================
        function showComboEffect(text) {
            const comboDisplay = document.getElementById('comboDisplay');
            comboDisplay.textContent = text;
            comboDisplay.style.opacity = '1';
            comboDisplay.style.transform = 'translate(-50%, -50%) scale(1.2)';
            
            setTimeout(() => {
                comboDisplay.style.opacity = '0';
                comboDisplay.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 1500);
        }

        function showMissionComplete(name, reward) {
            const popup = document.getElementById('missionPopup');
            popup.innerHTML = `
                <div style="font-size: 1.3em; margin-bottom: 0.5em;">üéâ –ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê!</div>
                <div style="font-size: 1.1em; margin-bottom: 0.5em;">${name}</div>
                <div style="color: #feca57; font-size: 1.2em; font-weight: bold;">+${reward} –æ—á–∫–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π</div>
            `;
            popup.style.opacity = '1';
            
            setTimeout(() => {
                popup.style.opacity = '0';
            }, 4000);
        }

        function showUpgradeNotification(text) {
            const notification = document.getElementById('upgradeNotification');
            notification.textContent = text;
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 2500);
        }

        // ==================== –û–°–ù–û–í–ù–û–ô –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ====================
        function startGameLoop() {
            if (gameInterval) {
                clearInterval(gameInterval);
            }
            
            gameInterval = setInterval(() => {
                updateGame();
                renderGame();
                gameTime += 1/60;
                
                if (Math.floor(gameTime) % 1 === 0) {
                    updateHUD();
                    checkMissions();
                }
            }, 16);
        }

        function updateGame() {
            const canvas = document.getElementById('gameCanvas');
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            if (window.gameMoveState.isMoving) {
                const oldX = player.x, oldY = player.y;
                
                // –£—á–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
                let currentSpeed = player.speed;
                if (player.powerups.speed > 0) {
                    currentSpeed *= 1.5;
                }
                
                player.x += window.gameMoveState.moveX * currentSpeed;
                player.y += window.gameMoveState.moveY * currentSpeed;
                const distanceMoved = Math.sqrt((player.x - oldX) ** 2 + (player.y - oldY) ** 2);
                player.totalDistance += distanceMoved;
                currentGameStats.distance += distanceMoved;
                
                // –ì—Ä–∞–Ω–∏—Ü—ã
                player.x = Math.max(player.size, Math.min(player.x, canvas.width - player.size));
                player.y = Math.max(player.size, Math.min(player.y, canvas.height - player.size));
            }

            // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞
            const dx = player.x - enemy.x;
            const dy = player.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 0) {
                let currentEnemySpeed = enemy.speed;
                if (player.powerups.slow > 0) {
                    currentEnemySpeed *= 0.5;
                }
                
                enemy.x += (dx / distance) * currentEnemySpeed;
                enemy.y += (dy / distance) * currentEnemySpeed;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–¥ –∏ –∫–æ–º–±–æ
            if (player.barrierCooldown > 0) player.barrierCooldown--;
            if (player.comboTimeout > 0) {
                player.comboTimeout--;
            } else if (player.combo > 1) {
                player.combo = 1;
                updateHUD();
            }

            // –°–ø–∞–≤–Ω –æ–±—ä–µ–∫—Ç–æ–≤
            updateSpawners();

            // –ö–æ–ª–ª–µ–∫—Ü–∏—è –±–∞—Ä—å–µ—Ä–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–π
            collectBarriers();
            collectPowerups();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π
            updatePowerups();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
            checkCollisions();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
            updateParticles();

            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            enemy.speed = enemy.baseSpeed + (gameTime / 60) * 0.15;
        }

        function updateSpawners() {
            // –°–ø–∞–≤–Ω –±–∞—Ä—å–µ—Ä–æ–≤
            barrierSpawnTimer++;
            if (barrierSpawnTimer >= GameConstants.BARRIER_SPAWN_RATE && barriers.length < GameConstants.MAX_BARRIERS) {
                spawnBarrier();
                barrierSpawnTimer = 0;
            }

            // –°–ø–∞–≤–Ω —É–ª—É—á—à–µ–Ω–∏–π
            powerupSpawnTimer++;
            if (powerupSpawnTimer >= GameConstants.POWERUP_SPAWN_RATE && powerups.length < GameConstants.MAX_POWERUPS) {
                spawnPowerup();
                powerupSpawnTimer = 0;
            }
        }

        function spawnBarrier() {
            const canvas = document.getElementById('gameCanvas');
            let validPosition = false;
            let attempts = 0;
            
            while (!validPosition && attempts < 15) {
                const x = Math.random() * (canvas.width - GameConstants.BARRIER_SIZE * 2) + GameConstants.BARRIER_SIZE;
                const y = Math.random() * (canvas.height - GameConstants.BARRIER_SIZE * 2) + GameConstants.BARRIER_SIZE;
                
                const distToPlayer = Math.sqrt(Math.pow(x - player.x, 2) + Math.pow(y - player.y, 2));
                const distToEnemy = Math.sqrt(Math.pow(x - enemy.x, 2) + Math.pow(y - enemy.y, 2));
                
                if (distToPlayer > 120 && distToEnemy > 120) {
                    barriers.push({
                        x: x,
                        y: y,
                        size: GameConstants.BARRIER_SIZE,
                        color: '#feca57',
                        rotation: 0,
                        rotationSpeed: (Math.random() - 0.5) * 0.05
                    });
                    validPosition = true;
                }
                attempts++;
            }
        }

        function collectBarriers() {
            for (let i = barriers.length - 1; i >= 0; i--) {
                const barrier = barriers[i];
                const dist = Math.sqrt((player.x - barrier.x) ** 2 + (player.y - barrier.y) ** 2);
                
                if (dist < player.size + barrier.size && player.barriers < player.maxBarriers) {
                    player.barriers++;
                    player.barriersCollected++;
                    currentGameStats.barriersCollected++;
                    
                    // –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–±–æ
                    player.comboTimeout = GameConstants.COMBO_TIMEOUT;
                    if (player.comboTimeout > 0) {
                        player.combo++;
                        if (player.combo >= 3) {
                            showComboEffect(`üî• –ö–û–ú–ë–û x${player.combo}!`);
                        }
                    }
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞
                    createParticles(barrier.x, barrier.y, 15, '#feca57');
                    barriers.splice(i, 1);
                    
                    // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —Å–±–æ—Ä
                    addXP(5 * player.combo);
                    
                    updateHUD();
                    updateHealthDisplay();
                }
            }
        }

        function checkCollisions() {
            const distToEnemy = Math.sqrt((player.x - enemy.x) ** 2 + (player.y - enemy.y) ** 2);
            const collisionDistance = player.size + enemy.size - 8;
            
            if (distToEnemy < collisionDistance) {
                if (player.hasActiveBarrier) {
                    // –ë–∞—Ä—å–µ—Ä –ø–æ–≥–ª–æ—â–∞–µ—Ç —É–¥–∞—Ä
                    player.hasActiveBarrier = false;
                    player.barrierCooldown = GameConstants.BARRIER_COOLDOWN;
                    player.isInvulnerable = true;
                    
                    const barrierBtn = document.getElementById('useBarrier');
                    barrierBtn.classList.remove('barrier-active');
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏—è
                    const pushForce = 10;
                    const pushX = (enemy.x - player.x) / distToEnemy;
                    const pushY = (enemy.y - player.y) / distToEnemy;
                    
                    enemy.x += pushX * pushForce;
                    enemy.y += pushY * pushForce;
                    player.x -= pushX * pushForce * 0.7;
                    player.y -= pushY * pushForce * 0.7;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                    createParticles(player.x, player.y, 30, '#feca57');
                    showComboEffect('üõ°Ô∏è –ó–ê–©–ò–¢–ê –°–†–ê–ë–û–¢–ê–õ–ê!');
                    
                    // –°–Ω–∏–º–∞–µ–º –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        player.isInvulnerable = false;
                    }, 500);
                    
                } else if (!player.isInvulnerable) {
                    // –ù–µ—Ç –∑–∞—â–∏—Ç—ã - —Å–º–µ—Ä—Ç—å
                    gameOver();
                    return;
                }
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –£–†–û–í–ù–ï–ô ====================
        function addXP(amount) {
            player.xp += amount;
            currentGameStats.xp += amount;
            const xpNeeded = player.level * GameConstants.LEVEL_UP_XP;
            
            if (player.xp >= xpNeeded) {
                player.level++;
                player.xp = 0;
                player.upgradePoints += 8;
                
                showUpgradeNotification(`üéâ –£–†–û–í–ï–ù–¨ ${player.level}! +8 –æ—á–∫–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π`);
                createParticles(player.x, player.y, 40, '#48dbfb');
                
                saveGame();
                updateMenuStats();
            }
            
            updateXPBar();
        }

        function updateXPBar() {
            const xpNeeded = player.level * GameConstants.LEVEL_UP_XP;
            const xpPercent = (player.xp / xpNeeded) * 100;
            document.getElementById('xpProgress').style.width = xpPercent + '%';
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –£–õ–£–ß–®–ï–ù–ò–ô ====================
        function buyUpgrade(type) {
            const costs = { speed: 15, barrier: 20, magnet: 30 };
            const cost = costs[type];
            
            if (player.upgradePoints >= cost) {
                player.upgrades[type]++;
                player.upgradePoints -= cost;
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–ª—É—á—à–µ–Ω–∏–µ
                applyUpgrades();
                updateUpgradesDisplay();
                saveGame();
                
                showUpgradeNotification(`‚úÖ –£–õ–£–ß–®–ï–ù–ò–ï –ü–†–ò–û–ë–†–ï–¢–ï–ù–û!`);
            } else {
                showUpgradeNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π');
            }
        }

        function updateUpgradesDisplay() {
            document.getElementById('speedLevel').textContent = player.upgrades.speed;
            document.getElementById('barrierLevel').textContent = player.upgrades.barrier;
            document.getElementById('magnetLevel').textContent = player.upgrades.magnet;
            document.getElementById('upgradePoints').textContent = player.upgradePoints;
        }

        // ==================== –†–ï–ù–î–ï–†–ò–ù–ì ====================
        function renderGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // –û—á–∏—Å—Ç–∫–∞ —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ñ–æ–Ω–æ–º
            ctx.fillStyle = '#0f0f1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç–∫–∞
            drawGrid(ctx, canvas);
            
            // –û–±—ä–µ–∫—Ç—ã –∏–≥—Ä—ã
            drawBarriers(ctx);
            drawPowerups(ctx);
            drawPlayer(ctx);
            drawEnemy(ctx);
            drawParticles(ctx);
        }

        function drawGrid(ctx, canvas) {
            const time = Date.now() * 0.001;
            ctx.strokeStyle = `rgba(255, 255, 255, ${0.03 + Math.sin(time) * 0.02})`;
            ctx.lineWidth = 1;
            
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function drawBarriers(ctx) {
            barriers.forEach(barrier => {
                barrier.rotation += barrier.rotationSpeed;
                
                ctx.save();
                ctx.translate(barrier.x, barrier.y);
                ctx.rotate(barrier.rotation);
                
                // –°–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowColor = barrier.color;
                ctx.shadowBlur = 15;
                
                // –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä—É–≥
                ctx.fillStyle = barrier.color;
                ctx.beginPath();
                ctx.arc(0, 0, barrier.size, 0, Math.PI * 2);
                ctx.fill();
                
                // –ò–∫–æ–Ω–∫–∞ —â–∏—Ç–∞
                ctx.fillStyle = '#ffffff';
                ctx.shadowBlur = 0;
                
                ctx.beginPath();
                ctx.moveTo(0, -barrier.size * 0.6);
                ctx.lineTo(barrier.size * 0.4, -barrier.size * 0.2);
                ctx.lineTo(barrier.size * 0.4, barrier.size * 0.4);
                ctx.lineTo(-barrier.size * 0.4, barrier.size * 0.4);
                ctx.lineTo(-barrier.size * 0.4, -barrier.size * 0.2);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            });
        }

        function drawPowerups(ctx) {
            const time = Date.now() * 0.001;
            
            powerups.forEach(powerup => {
                powerup.rotation += 0.02;
                const floatY = Math.sin(time + powerup.x * 0.01) * 3;
                
                ctx.save();
                ctx.translate(powerup.x, powerup.y + floatY);
                ctx.rotate(powerup.rotation);
                
                // –°–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowColor = powerup.color;
                ctx.shadowBlur = 20;
                
                // –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä—É–≥
                ctx.fillStyle = powerup.color;
                ctx.beginPath();
                ctx.arc(0, 0, powerup.size, 0, Math.PI * 2);
                ctx.fill();
                
                // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä—É–≥
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.arc(0, 0, powerup.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            });
        }

        function drawPlayer(ctx) {
            const time = Date.now() * 0.001;
            
            // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞—â–∏—Ç—ã
            if (player.hasActiveBarrier) {
                ctx.save();
                ctx.strokeStyle = '#feca57';
                ctx.lineWidth = 4;
                ctx.shadowColor = '#feca57';
                ctx.shadowBlur = 30;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size + 12, 0, Math.PI * 2);
                ctx.stroke();
                
                ctx.strokeStyle = 'rgba(254, 202, 87, 0.3)';
                ctx.lineWidth = 8;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size + 18, 0, Math.PI * 2);
                ctx.stroke();
                ctx.restore();
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç–∏
            if (player.isInvulnerable) {
                ctx.save();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 3;
                ctx.setLineDash([5, 5]);
                ctx.shadowColor = '#ffffff';
                ctx.shadowBlur = 20;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size + 10, 0, Math.PI * 2);
                ctx.stroke();
                ctx.restore();
            }
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞
            ctx.save();
            ctx.shadowColor = player.color;
            ctx.shadowBlur = 20;
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            // –õ–∏—Ü–æ –∏–≥—Ä–æ–∫–∞
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(player.x - 5, player.y - 4, 4, 0, Math.PI * 2);
            ctx.arc(player.x + 5, player.y - 4, 4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(player.x, player.y + 5, 3, 0, Math.PI);
            ctx.stroke();
        }

        function drawEnemy(ctx) {
            // –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä—É–≥ –≤—Ä–∞–≥–∞
            ctx.save();
            ctx.shadowColor = enemy.color;
            ctx.shadowBlur = 25;
            ctx.fillStyle = enemy.color;
            ctx.beginPath();
            ctx.arc(enemy.x, enemy.y, enemy.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            // –£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞–¥–ø–∏—Å—å "–°–û–°–ö–ê 69" —Å –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç—å—é
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold ' + (enemy.size * 0.35) + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // –¢–µ–Ω—å –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
            ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
            ctx.shadowBlur = 8;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            ctx.fillText('–°–û–°–ö–ê', enemy.x, enemy.y - 8);
            ctx.fillText('69', enemy.x, enemy.y + 8);
            
            // –°–±—Ä–æ—Å —Ç–µ–Ω–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            
            // –ì–ª–∞–∑–∞
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(enemy.x - enemy.size * 0.3, enemy.y - enemy.size * 0.2, enemy.size * 0.12, 0, Math.PI * 2);
            ctx.arc(enemy.x + enemy.size * 0.3, enemy.y - enemy.size * 0.2, enemy.size * 0.12, 0, Math.PI * 2);
            ctx.fill();
            
            // –†–æ—Ç
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(enemy.x, enemy.y + enemy.size * 0.15, enemy.size * 0.2, 0.1 * Math.PI, 0.9 * Math.PI);
            ctx.stroke();
        }

        // ==================== –ò–ù–¢–ï–†–§–ï–ô–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ====================
        function updateHUD() {
            // –¢–∞–π–º–µ—Ä
            const minutes = Math.floor(gameTime / 60);
            const seconds = Math.floor(gameTime % 60);
            document.getElementById('timer').textContent = 
                minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
            
            // –î–∏—Å—Ç–∞–Ω—Ü–∏—è
            document.getElementById('distance').textContent = Math.floor(currentGameStats.distance);
            
            // –£—Ä–æ–≤–µ–Ω—å
            document.getElementById('level').textContent = player.level;
            
            // –ö–æ–º–±–æ
            document.getElementById('combo').textContent = 'x' + player.combo;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∑–¥–æ—Ä–æ–≤—å—è
            updateHealthDisplay();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π
            updatePowerupIndicators();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏
            updateCooldownDisplay();
        }

        function updateHealthDisplay() {
            const indicators = document.querySelectorAll('.health-indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index < player.barriers);
            });
        }

        function updatePowerupIndicators() {
            const container = document.getElementById('powerupIndicators');
            container.innerHTML = '';
            
            for (const type in player.powerups) {
                if (player.powerups[type] > 0) {
                    const indicator = document.createElement('div');
                    indicator.className = `powerup-indicator ${type}`;
                    container.appendChild(indicator);
                }
            }
        }

        function updateCooldownDisplay() {
            const cooldownElement = document.getElementById('abilityCooldown');
            if (player.barrierCooldown > 0) {
                const secondsLeft = (player.barrierCooldown / 60).toFixed(1);
                cooldownElement.textContent = `–ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: ${secondsLeft}—Å`;
            } else {
                cooldownElement.textContent = '';
            }
        }

        function updateMenuStats() {
            document.getElementById('menuBestTime').textContent = formatTime(getBestTime());
            document.getElementById('menuLevel').textContent = player.level;
            document.getElementById('menuPoints').textContent = player.upgradePoints;
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return minutes.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        // ==================== –ö–û–ù–ï–¶ –ò–ì–†–´ ====================
        function gameOver() {
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
            currentGameStats.time = gameTime;
            
            // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥
            const earnedPoints = Math.floor(gameTime / 10);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            document.getElementById('finalTime').textContent = formatTime(currentGameStats.time);
            document.getElementById('finalBarriers').textContent = currentGameStats.barriersCollected;
            document.getElementById('finalDistance').textContent = Math.floor(currentGameStats.distance);
            document.getElementById('finalXP').textContent = currentGameStats.xp;
            document.getElementById('newUpgradePoints').textContent = earnedPoints;
            
            // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥
            player.upgradePoints += earnedPoints;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
            saveGame();
            
            // –ü–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            hideAllScreens();
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function restartGame() {
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            startGame();
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê –ò–ì–†–´ ====================
        window.addEventListener('load', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
            loadGame();
            
            // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += 2;
                document.getElementById('loadingProgress').style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        document.getElementById('loadingScreen').classList.add('hidden');
                        document.getElementById('mainMenu').classList.remove('hidden');
                    }, 500);
                }
            }, 50);
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', function() {
            if (document.getElementById('gameScreen').classList.contains('hidden')) return;
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
            renderGame();
        });
    </script>
</body>
</html>
