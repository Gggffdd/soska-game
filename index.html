<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>Number Chase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .hidden {
            display: none !important;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
        }
        
        .menu-content {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 2em;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 1em;
            color: white;
        }
        
        .menu-content h1 {
            font-size: 2em;
            margin-bottom: 0.5em;
        }
        
        .menu-btn {
            padding: 1em 2em;
            font-size: 1.1em;
            background: #ff6b6b;
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            margin: 0.5em;
            width: 200px;
            display: block;
        }
        
        #gameHUD {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .hud-top {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 1em;
        }
        
        .health-indicators {
            display: flex;
            gap: 5px;
        }
        
        .health-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .health-indicator.active {
            background: #feca57;
        }
        
        /* –ü–ª–∞–≤–∞—é—â–∏–π –¥–∂–æ–π—Å—Ç–∏–∫ */
        #floatingJoystick {
            position: absolute;
            width: 180px;
            height: 180px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .joystick-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .joystick-handle {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 0.1s;
        }
        
        .action-buttons {
            position: absolute;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            pointer-events: auto;
        }
        
        .action-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            font-size: 1.8em;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .barrier-active {
            background: rgba(254, 202, 87, 0.3) !important;
            border: 3px solid #feca57 !important;
        }
        
        .controls-hint {
            position: absolute;
            bottom: 120px;
            left: 0;
            right: 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
            pointer-events: none;
        }
        
        .debug-info {
            position: absolute;
            top: 50px;
            left: 10px;
            color: white;
            font-size: 0.8em;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="loadingScreen" class="screen">
            <div class="menu-content">
                <h1>NUMBER CHASE</h1>
                <div id="loadingStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <button class="menu-btn" onclick="skipLoading()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
            </div>
        </div>

        <div id="mainMenu" class="screen hidden">
            <div class="menu-content">
                <h1>NUMBER CHASE</h1>
                <p style="margin-bottom: 1em; color: rgba(255,255,255,0.8);">–ë–µ–≥–∏ –æ—Ç —á–∏—Å–ª–∞ 69!</p>
                <button class="menu-btn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button class="menu-btn" onclick="showInstructions()">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
            </div>
        </div>

        <div id="instructionsScreen" class="screen hidden">
            <div class="menu-content">
                <h1>–ö–ê–ö –ò–ì–†–ê–¢–¨</h1>
                <div style="text-align: left; margin: 1em 0;">
                    <p>‚Ä¢ –ö–∞—Å–∞–π—Ç–µ—Å—å –õ–ï–í–û–ô —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è</p>
                    <p>‚Ä¢ –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –ø–∞–ª–µ—Ü –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
                    <p>‚Ä¢ –î–∂–æ–π—Å—Ç–∏–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –º–µ—Å—Ç–µ –∫–∞—Å–∞–Ω–∏—è</p>
                    <p>‚Ä¢ –ù–∞–∂–∏–º–∞–π—Ç–µ –ø—Ä–∞–≤—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±–∞—Ä—å–µ—Ä–∞</p>
                    <p>‚Ä¢ –ë–∞—Ä—å–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏</p>
                    <p>‚Ä¢ –°–æ–±–∏—Ä–∞–π—Ç–µ –∂–µ–ª—Ç—ã–µ —â–∏—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã</p>
                    <p>‚Ä¢ –ë–µ–≥–∏—Ç–µ –æ—Ç —á–∏—Å–ª–∞ 69!</p>
                </div>
                <button class="menu-btn" onclick="showMainMenu()">–ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <div id="gameScreen" class="screen hidden">
            <canvas id="gameCanvas"></canvas>
            
            <div id="gameHUD">
                <div class="hud-top">
                    <div class="score-display">
                        <span>–í—Ä–µ–º—è: </span>
                        <span id="timer">0</span>
                    </div>
                    <div class="health-indicators" id="healthIndicators">
                        <div class="health-indicator"></div>
                        <div class="health-indicator"></div>
                        <div class="health-indicator"></div>
                    </div>
                </div>
                
                <div class="debug-info" id="debugInfo">
                    –ë–∞—Ä—å–µ—Ä—ã: 0 | –ó–∞—â–∏—Ç–∞: –ù–ï–¢
                </div>
                
                <!-- –ü–ª–∞–≤–∞—é—â–∏–π –¥–∂–æ–π—Å—Ç–∏–∫ -->
                <div id="floatingJoystick">
                    <div class="joystick-base"></div>
                    <div class="joystick-handle"></div>
                </div>
                
                <div class="controls-hint">
                    –ö–∞—Å–∞–π—Ç–µ—Å—å –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn" id="useBarrier">üõ°Ô∏è</button>
                </div>
            </div>
        </div>

        <div id="gameOverScreen" class="screen hidden">
            <div class="menu-content">
                <h1>GAME OVER</h1>
                <p>–í—Ä–µ–º—è: <span id="finalTime">0</span></p>
                <p>–°–æ–±—Ä–∞–Ω–æ –±–∞—Ä—å–µ—Ä–æ–≤: <span id="finalBarriers">0</span></p>
                <button class="menu-btn" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                <button class="menu-btn" onclick="showMainMenu()">–í –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameTime = 0;
        let gameInterval = null;
        let player = { 
            x: 0, 
            y: 0, 
            barriers: 0,
            hasActiveBarrier: false,
            isInvulnerable: false
        };
        let enemy = { x: 0, y: 0 };
        let barriers = [];
        let barrierSpawnTimer = 0;
        let isJoystickActive = false;
        let joystickStartX = 0;
        let joystickStartY = 0;
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        const GameConstants = {
            PLAYER_SIZE: 15,
            ENEMY_SIZE: 30,
            BARRIER_SIZE: 10,
            PLAYER_SPEED: 4,
            BARRIER_SPAWN_RATE: 600,
            MAX_BARRIERS: 8,
            JOYSTICK_RADIUS: 80
        };
        
        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function skipLoading() {
            showMainMenu();
        }
        
        function showMainMenu() {
            hideAllScreens();
            document.getElementById('mainMenu').classList.remove('hidden');
        }
        
        function showInstructions() {
            hideAllScreens();
            document.getElementById('instructionsScreen').classList.remove('hidden');
        }
        
        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function startGame() {
            console.log('Starting game...');
            hideAllScreens();
            document.getElementById('gameScreen').classList.remove('hidden');
            
            initializeGame();
            startGameLoop();
        }
        
        function initializeGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            player = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                size: GameConstants.PLAYER_SIZE,
                color: '#48dbfb',
                barriers: 0,
                speed: GameConstants.PLAYER_SPEED,
                hasActiveBarrier: false,
                isInvulnerable: false
            };
            
            enemy = {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: GameConstants.ENEMY_SIZE,
                color: '#ff6b6b',
                speed: 2
            };
            
            barriers = [];
            barrierSpawnTimer = 0;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            initControls();
            
            console.log('Game initialized');
            updateDebugInfo();
        }
        
        function initControls() {
            const canvas = document.getElementById('gameCanvas');
            const barrierBtn = document.getElementById('useBarrier');
            const joystick = document.getElementById('floatingJoystick');
            const joystickHandle = document.querySelector('.joystick-handle');
            
            let currentTouchId = null;
            let moveX = 0;
            let moveY = 0;
            
            // Touch —Å–æ–±—ã—Ç–∏—è –¥–ª—è –≤—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–∞
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);
            canvas.addEventListener('touchcancel', handleTouchEnd);
            
            // Mouse —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);
            
            // –ö–Ω–æ–ø–∫–∞ –±–∞—Ä—å–µ—Ä–∞
            barrierBtn.addEventListener('click', useBarrier);
            barrierBtn.addEventListener('touchstart', useBarrier);
            
            function handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–∂–æ–π—Å—Ç–∏–∫ —Ç–æ–ª—å–∫–æ –≤ –ª–µ–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ —ç–∫—Ä–∞–Ω–∞
                if (x < canvas.width / 2) {
                    activateJoystick(x, y);
                    currentTouchId = touch.identifier;
                }
            }
            
            function handleTouchMove(e) {
                if (!isJoystickActive) return;
                
                e.preventDefault();
                const touch = Array.from(e.touches).find(t => t.identifier === currentTouchId);
                if (!touch) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                updateJoystick(x, y);
            }
            
            function handleTouchEnd(e) {
                if (!isJoystickActive) return;
                
                e.preventDefault();
                deactivateJoystick();
                currentTouchId = null;
            }
            
            function handleMouseDown(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–∂–æ–π—Å—Ç–∏–∫ —Ç–æ–ª—å–∫–æ –≤ –ª–µ–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ —ç–∫—Ä–∞–Ω–∞
                if (x < canvas.width / 2) {
                    activateJoystick(x, y);
                }
            }
            
            function handleMouseMove(e) {
                if (!isJoystickActive) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                updateJoystick(x, y);
            }
            
            function handleMouseUp() {
                if (!isJoystickActive) return;
                deactivateJoystick();
            }
            
            function activateJoystick(x, y) {
                isJoystickActive = true;
                joystickStartX = x;
                joystickStartY = y;
                
                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –¥–∂–æ–π—Å—Ç–∏–∫
                joystick.style.left = (x - 90) + 'px';
                joystick.style.top = (y - 90) + 'px';
                joystick.style.display = 'block';
                
                moveX = 0;
                moveY = 0;
                updateJoystickHandle(0, 0);
            }
            
            function updateJoystick(x, y) {
                const deltaX = x - joystickStartX;
                const deltaY = y - joystickStartY;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ —Ä—É—á–∫–∏ –¥–∂–æ–π—Å—Ç–∏–∫–∞
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = GameConstants.JOYSTICK_RADIUS;
                
                if (distance > maxDistance) {
                    const scale = maxDistance / distance;
                    moveX = (deltaX * scale) / maxDistance;
                    moveY = (deltaY * scale) / maxDistance;
                    updateJoystickHandle(deltaX * scale, deltaY * scale);
                } else {
                    moveX = deltaX / maxDistance;
                    moveY = deltaY / maxDistance;
                    updateJoystickHandle(deltaX, deltaY);
                }
            }
            
            function updateJoystickHandle(x, y) {
                const joystickHandle = document.querySelector('.joystick-handle');
                joystickHandle.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
            }
            
            function deactivateJoystick() {
                isJoystickActive = false;
                moveX = 0;
                moveY = 0;
                
                const joystick = document.getElementById('floatingJoystick');
                joystick.style.display = 'none';
                
                const joystickHandle = document.querySelector('.joystick-handle');
                joystickHandle.style.transform = 'translate(-50%, -50%)';
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
            window.gameMoveState = { 
                isMoving: isJoystickActive, 
                moveX: moveX, 
                moveY: moveY 
            };
            
            setInterval(() => {
                window.gameMoveState = { 
                    isMoving: isJoystickActive, 
                    moveX: moveX, 
                    moveY: moveY 
                };
            }, 16);
        }
        
        function useBarrier() {
            if (player.barriers > 0 && !player.hasActiveBarrier) {
                player.barriers--;
                player.hasActiveBarrier = true;
                updateHealthDisplay();
                
                const barrierBtn = document.getElementById('useBarrier');
                barrierBtn.classList.add('barrier-active');
                
                console.log('–ë–∞—Ä—å–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
                updateDebugInfo();
            }
        }
        
        function updateHealthDisplay() {
            const indicators = document.querySelectorAll('.health-indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index < player.barriers);
            });
        }
        
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const barrierStatus = player.hasActiveBarrier ? '–ê–ö–¢–ò–í–ù–ê' : '–ù–ï–¢';
            debugInfo.textContent = `–ë–∞—Ä—å–µ—Ä—ã: ${player.barriers} | –ó–∞—â–∏—Ç–∞: ${barrierStatus}`;
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function startGameLoop() {
            gameTime = 0;
            barrierSpawnTimer = 0;
            updateTimer();
            
            gameInterval = setInterval(() => {
                updateGame();
                renderGame();
                gameTime += 1/60;
                
                if (Math.floor(gameTime) % 1 === 0) {
                    updateTimer();
                }
            }, 16);
        }
        
        function updateGame() {
            const canvas = document.getElementById('gameCanvas');
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            if (window.gameMoveState && window.gameMoveState.isMoving) {
                player.x += window.gameMoveState.moveX * player.speed;
                player.y += window.gameMoveState.moveY * player.speed;
                
                // –ì—Ä–∞–Ω–∏—Ü—ã
                player.x = Math.max(player.size, Math.min(player.x, canvas.width - player.size));
                player.y = Math.max(player.size, Math.min(player.y, canvas.height - player.size));
            }
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞
            const dx = player.x - enemy.x;
            const dy = player.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 0) {
                enemy.x += (dx / distance) * enemy.speed;
                enemy.y += (dy / distance) * enemy.speed;
            }
            
            // –°–ø–∞–≤–Ω –±–∞—Ä—å–µ—Ä–æ–≤
            barrierSpawnTimer++;
            if (barrierSpawnTimer >= GameConstants.BARRIER_SPAWN_RATE && barriers.length < GameConstants.MAX_BARRIERS) {
                spawnBarrier();
                barrierSpawnTimer = 0;
            }
            
            // –ö–æ–ª–ª–µ–∫—Ü–∏—è –±–∞—Ä—å–µ—Ä–æ–≤
            for (let i = barriers.length - 1; i >= 0; i--) {
                const barrier = barriers[i];
                const dist = Math.sqrt(
                    Math.pow(player.x - barrier.x, 2) + 
                    Math.pow(player.y - barrier.y, 2)
                );
                
                if (dist < player.size + barrier.size && player.barriers < 3) {
                    player.barriers++;
                    barriers.splice(i, 1);
                    updateHealthDisplay();
                    updateDebugInfo();
                    console.log('–ë–∞—Ä—å–µ—Ä –ø–æ–¥–æ–±—Ä–∞–Ω! –í—Å–µ–≥–æ –±–∞—Ä—å–µ—Ä–æ–≤:', player.barriers);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –≤—Ä–∞–≥–æ–º
            const distToEnemy = Math.sqrt(
                Math.pow(player.x - enemy.x, 2) + 
                Math.pow(player.y - enemy.y, 2)
            );
            
            const collisionDistance = player.size + enemy.size - 5; // –ù–µ–±–æ–ª—å—à–æ–π –∑–∞–∑–æ—Ä
            
            if (distToEnemy < collisionDistance) {
                if (player.hasActiveBarrier) {
                    // –ë–∞—Ä—å–µ—Ä –ø–æ–≥–ª–æ—â–∞–µ—Ç —É–¥–∞—Ä
                    player.hasActiveBarrier = false;
                    const barrierBtn = document.getElementById('useBarrier');
                    barrierBtn.classList.remove('barrier-active');
                    
                    // –û—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ –≤—Ä–∞–≥–∞
                    const pushForce = 8;
                    const pushX = (enemy.x - player.x) / distToEnemy;
                    const pushY = (enemy.y - player.y) / distToEnemy;
                    enemy.x += pushX * pushForce;
                    enemy.y += pushY * pushForce;
                    
                    // –û—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
                    player.x -= pushX * pushForce;
                    player.y -= pushY * pushForce;
                    
                    console.log('–ë–∞—Ä—å–µ—Ä –ø–æ–≥–ª–æ—Ç–∏–ª —É–¥–∞—Ä!');
                    updateDebugInfo();
                    
                } else {
                    gameOver();
                    return;
                }
            }
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            if (gameTime > 30) {
                enemy.speed = 2 + (gameTime - 30) / 30;
            }
        }
        
        function spawnBarrier() {
            const canvas = document.getElementById('gameCanvas');
            let validPosition = false;
            let attempts = 0;
            
            while (!validPosition && attempts < 10) {
                const x = Math.random() * (canvas.width - GameConstants.BARRIER_SIZE * 2) + GameConstants.BARRIER_SIZE;
                const y = Math.random() * (canvas.height - GameConstants.BARRIER_SIZE * 2) + GameConstants.BARRIER_SIZE;
                
                const distToPlayer = Math.sqrt(Math.pow(x - player.x, 2) + Math.pow(y - player.y, 2));
                const distToEnemy = Math.sqrt(Math.pow(x - enemy.x, 2) + Math.pow(y - enemy.y, 2));
                
                if (distToPlayer > 100 && distToEnemy > 100) {
                    barriers.push({
                        x: x,
                        y: y,
                        size: GameConstants.BARRIER_SIZE,
                        color: '#feca57'
                    });
                    validPosition = true;
                    console.log('–ù–æ–≤—ã–π –±–∞—Ä—å–µ—Ä —Å–æ–∑–¥–∞–Ω! –í—Å–µ–≥–æ –±–∞—Ä—å–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ:', barriers.length);
                }
                attempts++;
            }
        }
        
        function renderGame() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // –ë–∞—Ä—å–µ—Ä—ã
            barriers.forEach(barrier => {
                ctx.fillStyle = barrier.color;
                ctx.beginPath();
                ctx.arc(barrier.x, barrier.y, barrier.size, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.moveTo(barrier.x, barrier.y - barrier.size * 0.6);
                ctx.lineTo(barrier.x + barrier.size * 0.4, barrier.y - barrier.size * 0.2);
                ctx.lineTo(barrier.x + barrier.size * 0.4, barrier.y + barrier.size * 0.4);
                ctx.lineTo(barrier.x - barrier.size * 0.4, barrier.y + barrier.size * 0.4);
                ctx.lineTo(barrier.x - barrier.size * 0.4, barrier.y - barrier.size * 0.2);
                ctx.closePath();
                ctx.fill();
            });
            
            // –ò–≥—Ä–æ–∫
            if (player.hasActiveBarrier) {
                // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞—â–∏—Ç—ã
                ctx.strokeStyle = '#feca57';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size + 8, 0, Math.PI * 2);
                ctx.stroke();
                
                // –°–≤–µ—á–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã
                ctx.strokeStyle = 'rgba(254, 202, 87, 0.3)';
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.size + 12, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(player.x - 4, player.y - 3, 3, 0, Math.PI * 2);
            ctx.arc(player.x + 4, player.y - 3, 3, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(player.x, player.y + 4, 2, 0, Math.PI);
            ctx.stroke();
            
            // –í—Ä–∞–≥
            ctx.fillStyle = enemy.color;
            ctx.beginPath();
            ctx.arc(enemy.x, enemy.y, enemy.size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold ' + (enemy.size * 0.8) + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('69', enemy.x, enemy.y);
            
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(enemy.x - enemy.size * 0.3, enemy.y - enemy.size * 0.2, enemy.size * 0.1, 0, Math.PI * 2);
            ctx.arc(enemy.x + enemy.size * 0.3, enemy.y - enemy.size * 0.2, enemy.size * 0.1, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function updateTimer() {
            const minutes = Math.floor(gameTime / 60);
            const seconds = Math.floor(gameTime % 60);
            document.getElementById('timer').textContent = 
                minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
        }
        
        function gameOver() {
            clearInterval(gameInterval);
            document.getElementById('finalTime').textContent = document.getElementById('timer').textContent;
            document.getElementById('finalBarriers').textContent = player.barriers;
            hideAllScreens();
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }
        
        function restartGame() {
            clearInterval(gameInterval);
            startGame();
        }
        
        window.addEventListener('load', function() {
            console.log('Page loaded');
            
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainMenu').classList.remove('hidden');
            }, 1000);
        });
        
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
